<!doctype html>
<html>
	<head>
	<title>cbVid</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato">
	<link rel="stylesheet" href="//releases.flowplayer.org/6.0.3/skin/functional.css">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="//releases.flowplayer.org/6.0.3/flowplayer.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular-animate.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular-cookies.js"></script>
	<script src="./socket.io/socket.io.js"></script>
	<script src="./crypto/jsrp-browser.js"></script>
	<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
	<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.4/ui-bootstrap-tpls.min.js"></script>
	<script src="controllers.js"></script>
	<script src="directives.js"></script>
	<script src="services.js"></script>
	<style type="text/css">
		body { font-family: 'Lato', serif; }
	</style>
</head>
<body ng-app="cbVidApp" style="background-color: #F8F8F8" oncontextmenu="return false;">
	<div ng-controller="mainController" style="height: 100%" drag-and-drop>

		<script type="text/ng-template" id="uploadForm.html">
			<div class="modal-header">
				<h3 class="modal-title">Upload A Video</h3>
			</div>
			<div class="modal-body">
				<div style="padding-bottom: 20px">
					<button class="btn btn-default" ng-click="viewers.push({username: ''})">Add Viewer</button>
				</div>
				<table ng-if="viewers.length > 0" class="table table-striped">
					<tr>
						<td>Viewer</td>
						<td align="right" style="padding-right: 25px">Action</td>
					</tr>
					<tr ng-repeat="user in viewers">
						<td>
							<input ng-model="user.username" ng-change="checkViewers()" ng-trim="false" maxlength="20" class="form-control" type="text" placeholder="Username">
						</td>
						<td align="right">
							<button class="btn btn-default" ng-click="viewers.splice($index, 1)">Remove</button>
						</td>
					</tr>
				</table>
				<div style="padding-bottom: 10px; padding-left: 10px">
					<label class="radio-inline"><input type="radio" name="optradio" ng-model="type" value="file">File</label>
					<label class="radio-inline"><input type="radio" name="optradio" ng-model="type" value="torrent">Torrent</label>
					<label class="radio-inline"><input type="radio" name="optradio" ng-model="type" value="ingest">Ingest</label>
				</div>
				<table class="table">
					<tr ng-show="type == 'file'">
						<td>
							<div class="input-group">
								<span class="input-group-btn">
									<span class="btn btn-primary btn-file">
										Browse&hellip; <input type="file" id="file" onchange="angular.element(this).scope().fileChanged()">
									</span>
								</span>
								<input type="text" class="form-control" readonly>
							</div>
            			</td>
						<td align="right"><button class="btn btn-default" id="upload" ng-click="upload()">Upload</button></td>
					</tr>
					<tr ng-show="type == 'torrent'">
						<td width="100%"><input type="text" ng-model="custom.magnet" class="form-control" placeholder="Magnet Link"></td>
						<td align="right"><button class="btn btn-default" id="torrent" ng-click="sendTorrent()">Torrent</button></td>
					</tr>
					<tr ng-show="type == 'ingest'">
						<td width="100%"><input type="text" ng-model="custom.ingest" class="form-control" placeholder="URL"></td>
						<td align="right"><button class="btn btn-default" id="ingest" ng-click="sendIngest()">Ingest</button></td>
					</tr>
				</table>
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary" type="button" ng-click="ok()">Close</button>
			</div>
		</script>
		<script type="text/ng-template" id="progressForm.html">
			<div class="modal-header">
				<h3 class="modal-title">Video Progress</h3>
			</div>
			<div class="modal-body">
				<table ng-if="!(uploading | isEmpty) || !(processing | isEmpty)" width="100%">
					<tr ng-hide="uploading | isEmpty" ng-repeat="(file, details) in uploading">
						<td align="center" style="border-top: 1px solid black; border-bottom: 1px solid black">
							<div style="padding-top: 10px; padding-bottom: 10px">{{file}}</div>
							<progressbar style="max-width: 400px" max="100" value="details.percent" type="success"><b>{{details.percent}}%</b></progressbar>
						</td>
					</tr>
					<tr ng-hide="processing | isEmpty" ng-repeat="(md5, details) in processing">
						<td align="center" style="border-top: 1px solid black; border-bottom: 1px solid black">
							<div style="padding-top: 10px; padding-bottom: 10px">{{details.name}}</div>
							<progressbar style="max-width: 400px" ng-if="details.percent" max="100" value="details.percent" type="warning"><b>{{details.percent}}%</b></progressbar>
							<div ng-if="details.name && !details.percent" style="padding-bottom: 10px">Processed (hh:mm:ss): {{details.timestamp}}</div>
						</td>
					</tr>
				</table>
				<div ng-show="(uploading | isEmpty) && (processing | isEmpty)" style="text-align: center"><h3>No updates yet.</h3></div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary" type="button" ng-click="ok()">Close</button>
			</div>
		</script>


		<div ng-if="!authed" loginform class="flex"></div>

		<nav ng-show="authed" class="navbar navbar-default navbar-static-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">
						<img alt="cbVid" style="max-height: 23px" src="logo.png">
					</a>
				</div>
				<div>
					<ul class="nav navbar-nav navbar-right">
						<li style="margin-right: 20px"><a href="#" ng-if="!(uploading | isEmpty) || !(processing | isEmpty)" ng-click="showProgressDialog()">Progress <img src="loading_2.gif" style="max-height: 23px"></a></li>
						<li><a href="#" ng-click="showUploadDialog()">Upload</a></li>
						<li><a href="#" ng-click="logout()">Logout ({{fields.username}})</a></li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="container-fluid" ng-show="authed" drag-and-drop style="height: 100%">
			<div class="row">
				<div ng-show="!(videoList | isEmpty)" class="col-lg-6">
					<div style="text-align: center">
						<div class="player"></div>
						<h3 style="margin-bottom: 20px">{{activeVideo.details.original}}</h2>
						<h5 style="margin-bottom: 50px">Uploaded: <span ng-bind="activeVideo.details.date | date:'medium'"></span></h4>
					</div>
				</div>
				<div ng-show="!(videoList | isEmpty)" class="col-lg-6">
					<ul class="example-animate-container">
						<li ng-repeat="video in videoList | orderBy: 'details.original'" class="animate-repeat ellipsis">
							<button ng-if="video.edit" style="margin-right: 10px" type="button" class="btn btn-default btn-sm" ng-click="deleteVideo(video.filename)">
								<span class="glyphicon glyphicon-trash"></span>
							</button>
							<button ng-if="!video.edit" style="margin-right: 10px" type="button" class="btn btn-default btn-sm" ng-click="removeMe(video.filename)">
								<span class="glyphicon glyphicon-remove"></span>
							</button>
							<span style="cursor: pointer" ng-class="{'activevideo': video.filename == activeVideo.filename, 'newvideo' : video.new }" ng-bind="video.details.original" ng-click="setVideo(video)">
							</span>
						</li>
					</ul>
				</div>
				<div ng-show="fetched && (videoList | isEmpty)" style="text-align: center"><h2>It looks like you have not uploaded any videos!  Choose Upload to get started.</h2></div>
			</div>
		</div>
	</div>
</body>
</html>